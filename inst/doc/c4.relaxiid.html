<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Logit models relaxing the iid hypothesis</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Logit models relaxing the iid hypothesis</h1>



<p>In the previous section, we assumed that the error terms were iid (identically and independently distributed), i.e., uncorrelated and homoscedastic. Extensions of the basic multinomial logit model have been proposed by relaxing one of these two hypothesis while maintaining the hypothesis of a Gumbel distribution.</p>
<div id="the-heteroskedastic-logit-model" class="section level2">
<h2>The heteroskedastic logit model</h2>
<p>The heteroskedastic logit model was proposed by <span class="citation">Bhat (1995)</span>. The probability that <span class="math inline">\(U_l&gt;U_j\)</span> is:</p>
<p><span class="math display">\[
P(\epsilon_j&lt;V_l-V_j+\epsilon_l)=e^{-e^{-\frac{(V_l-V_j+\epsilon_l)}{\theta_j}}},
\]</span></p>
<p>which implies the following conditional and unconditional probabilities</p>
<span class="math display">\[\begin{equation*}
  (P_l \mid \epsilon_l) =\prod_{j\neq
    l}e^{-e^{-\frac{(V_l-V_j+\epsilon_l)}{\theta_j}}},
\end{equation*}\]</span>
<span class="math display">\[\begin{equation*}
  \begin{array}{rcl}
  P_l&amp;=&amp;\displaystyle\int_{-\infty}^{+\infty} \prod_{j\neq l}
  \left(e^{-e^{-\frac{(V_l-V_j+t)}{\theta_j}}}\right)\frac{1}{\theta_l}e^{-\frac{t}{\theta_l}}e^{-e^{-\frac{t}{\theta_l}}}
  dt\\
 &amp;=&amp; \displaystyle \int_{0}^{+\infty}\left(e^{-\sum_{j \neq
      l}e^{-\frac{V_l-V_j-\theta_l \ln t}{\theta_j}}}\right)e^{-t}dt.
     \end{array}
\end{equation*}\]</span>
<p>There is no closed form for this integral, but it can be efficiently computed using a Gauss quadrature method, and more precisely the Gauss-Laguerre quadrature method.</p>
</div>
<div id="the-nested-logit-model" class="section level2">
<h2>The nested logit model</h2>
<p>The nested logit model was first proposed by <span class="citation">(McFadden 1978)</span>. It is a generalization of the multinomial logit model that is based on the idea that some alternatives may be joined in several groups (called nests). The error terms may then present some correlation in the same nest, whereas error terms of different nests are still uncorrelated.</p>
<p>Denoting <span class="math inline">\(m=1... M\)</span> the nests and <span class="math inline">\(B_m\)</span> the set of alternatives belonging to nest <span class="math inline">\(m\)</span>, the cumulative distribution of the errors is:</p>
<p><span class="math display">\[
\mbox{exp}\left(-\sum_{m=1}^M \left( \sum_{j \in B_m}
    e^{-\epsilon_j/\lambda_m}\right)^{\lambda_m}\right).
\]</span></p>
<p>The marginal distributions of the <span class="math inline">\(\epsilon\)</span>s are still univariate extreme value, but there is now some correlation within nests. <span class="math inline">\(1-\lambda_m\)</span> is a measure of the correlation, i.e., <span class="math inline">\(\lambda_m = 1\)</span> implies no correlation. In the special case where <span class="math inline">\(\lambda_m=1\; \forall m\)</span>, the errors are iid Gumbel errors and the nested logit model reduce to the multinomial logit model. It can then be shown that the probability of choosing alternative <span class="math inline">\(j\)</span> that belongs to nest <span class="math inline">\(l\)</span> is:</p>
<p><span class="math display">\[
P_j = \frac{e^{V_j/\lambda_l}\left(\sum_{k \in B_l}
    e^{V_k/\lambda_l}\right)^{\lambda_l-1}} {\sum_{m=1}^M\left(\sum_{k
      \in B_m} e^{V_k/\lambda_m}\right)^{\lambda_m}},
\]</span></p>
<p>and that this model is a random utility model if all the <span class="math inline">\(\lambda\)</span> parameters are in the <span class="math inline">\(0-1\)</span> interval.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Let us now write the deterministic part of the utility of alternative <span class="math inline">\(j\)</span> as the sum of two terms: the first one (<span class="math inline">\(Z_j\)</span>) being specific to the alternative and the second one (<span class="math inline">\(W_l\)</span>) to the nest it belongs to:</p>
<p><span class="math display">\[V_j=Z_j+W_l.\]</span></p>
<p>We can then rewrite the probabilities as follow:</p>
<p><span class="math display">\[
\begin{array}{rcl}  
P_j&amp;=&amp;\frac{e^{(Z_j+W_l)/\lambda_l}}{\sum_{k \in B_l}
  e^{(Z_k+W_l)/\lambda_l}}\times \frac{\left(\sum_{k \in B_l}
    e^{(Z_k+W_l)/\lambda_l}\right)^{\lambda_l}}
{\sum_{m=1}^M\left(\sum_{k \in B_m}
    e^{(Z_k+W_m)/\lambda_m}\right)^{\lambda_m}}\\
&amp;=&amp;\frac{e^{Z_j/\lambda_l}}{\sum_{k \in B_l}
    e^{Z_k/\lambda_l}}\times 
\frac{\left(e^{W_l/\lambda_l}\sum_{k \in B_l} e^{Z_k/\lambda_l}\right)^{\lambda_l}}
{\sum_{m=1}^M\left(e^{W_m/\lambda_m}\sum_{k
      \in B_m} e^{Z_k/\lambda_m}\right)^{\lambda_m}}.
\end{array}
\]</span></p>
<p>Then denote <span class="math inline">\(I_l=\ln \sum_{k \in B_l} e^{Z_k/\lambda_l}\)</span> which is often called the log-sum, the inclusive value or the inclusive utility.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> We then can write the probability of choosing alternative <span class="math inline">\(j\)</span> as:</p>
<p><span class="math display">\[
P_j=\frac{e^{Z_j/\lambda_l}}{\sum_{k \in B_l}
    e^{Z_k/\lambda_l}}\times 
\frac{e^{W_l+\lambda_l I_l}}{\sum_{m=1}^Me^{W_m+\lambda_m I_m}}.
\]</span></p>
<p>The first term <span class="math inline">\(\mbox{P}_{j\mid l}\)</span> is the conditional probability of choosing alternative <span class="math inline">\(j\)</span> if nest <span class="math inline">\(l\)</span> is chosen. It is often referred as the <em>lower model</em>. The second term <span class="math inline">\(\mbox{P}_l\)</span> is the marginal probability of choosing nest <span class="math inline">\(l\)</span> and is referred as the <em>upper model</em>. <span class="math inline">\(W_l+\lambda_l I_l\)</span> can be interpreted as the expected utility of choosing the best alternative in <span class="math inline">\(l\)</span>, <span class="math inline">\(W_l\)</span> being the expected utility of choosing an alternative in this nest (whatever this alternative is) and <span class="math inline">\(\lambda_l I_l\)</span> being the expected extra utility gained by being able to choose the best alternative in the nest. The inclusive values link the two models. It is then straightforward to show that IIA applies within nests, but not for two alternatives in different nests.</p>
<p>A consistent but inefficient way of estimating the nested logit model is to estimate separately its two components. The coefficients of the lower model are first estimated, which enables the computation of the inclusive values <span class="math inline">\(I_l\)</span>. The coefficients of the upper model are then estimated, using <span class="math inline">\(I_l\)</span> as covariates. Maximizing directly the likelihood function of the nested model leads to a more efficient estimator.</p>
</div>
<div id="applications" class="section level2">
<h2>Applications</h2>
<div id="modecanada" class="section level3">
<h3>ModeCanada</h3>
<p><span class="citation">Bhat (1995)</span> estimated the heteroscedastic logit model on the <code>ModeCanada</code> data set. Using <code>mlogit</code>, the heteroscedastic logit model is obtained by setting the <code>heterosc</code> argument to <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;mlogit&quot;</span>)
<span class="kw">data</span>(<span class="st">&quot;ModeCanada&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mlogit&quot;</span>)
MC &lt;-<span class="st"> </span><span class="kw">dfidx</span>(ModeCanada, <span class="dt">subset =</span> noalt <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">idnames =</span> <span class="kw">c</span>(<span class="st">&quot;chid&quot;</span>, <span class="st">&quot;alt&quot;</span>))
ml.MC &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>freq <span class="op">+</span><span class="st"> </span>cost <span class="op">+</span><span class="st"> </span>ivt <span class="op">+</span><span class="st"> </span>ovt <span class="op">|</span><span class="st"> </span>urban <span class="op">+</span><span class="st"> </span>income, MC, 
<span class="dt">reflevel =</span> <span class="st">'car'</span>, <span class="dt">alt.subset =</span> <span class="kw">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;air&quot;</span>))
hl.MC &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span>freq <span class="op">+</span><span class="st"> </span>cost <span class="op">+</span><span class="st"> </span>ivt <span class="op">+</span><span class="st"> </span>ovt <span class="op">|</span><span class="st"> </span>urban <span class="op">+</span><span class="st"> </span>income, MC, 
<span class="dt">reflevel =</span> <span class="st">'car'</span>, <span class="dt">alt.subset =</span> <span class="kw">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;air&quot;</span>), <span class="dt">heterosc =</span> <span class="ot">TRUE</span>)
<span class="kw">coef</span>(<span class="kw">summary</span>(hl.MC))[<span class="dv">11</span><span class="op">:</span><span class="dv">12</span>, ]</code></pre></div>
<pre><code>##           Estimate Std. Error   z-value     Pr(&gt;|z|)
## sp.train 1.2371829  0.1104610 11.200182 0.000000e+00
## sp.air   0.5403239  0.1118353  4.831425 1.355592e-06</code></pre>
<p>The variance of the error terms of train and air are respectively higher and lower than the variance of the error term of car (set to 1). Note that the z-values and p-values of the output are not particularly meaningful, as the hypothesis that the coefficient is zero (and not one) is tested. The homoscedasticity hypothesis can be tested using any of the three tests. A particular convenient syntax is provided in this case. For the likelihood ratio and the wald test, one can use only the fitted heteroscedastic model as argument. In this case, it is guessed that the hypothesis that the user wants to test is the homoscedasticity hypothesis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lr.heter &lt;-<span class="st"> </span><span class="kw">lrtest</span>(hl.MC, ml.MC)
wd.heter &lt;-<span class="st"> </span><span class="kw">waldtest</span>(hl.MC, <span class="dt">heterosc =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>or, more simply:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lrtest</span>(hl.MC)
<span class="kw">waldtest</span>(hl.MC)</code></pre></div>
<p>The Wald test can also be computed using the <code>linearHypothesis</code> function from the <code>car</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;car&quot;</span>)
lh.heter &lt;-<span class="st"> </span><span class="kw">linearHypothesis</span>(hl.MC, <span class="kw">c</span>(<span class="st">'sp.air = 1'</span>, <span class="st">'sp.train = 1'</span>))</code></pre></div>
<p>For the score test, we provide the constrained model as argument, which is the standard multinomial logit model and the supplementary argument which defines the unconstrained model, which is in this case <code>heterosc = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc.heter &lt;-<span class="st"> </span><span class="kw">scoretest</span>(ml.MC, <span class="dt">heterosc =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(<span class="kw">list</span>(<span class="dt">wald =</span> wd.heter, <span class="dt">lh =</span> lh.heter, <span class="dt">score =</span> sc.heter,
<span class="dt">lr =</span> lr.heter), statpval)</code></pre></div>
<pre><code>##           wald     lh score    lr
## stat    25.196 25.196 9.488 6.888
## p-value  0.000  0.000 0.009 0.032</code></pre>
<p>The homoscedasticity hypothesis is strongly rejected using the Wald test, but only at the 1 and 5% level for, respectively, the score and the likelihood ratio tests.</p>
</div>
<div id="japanesefdi" class="section level3">
<h3>JapaneseFDI</h3>
<p><span class="citation">Head and Mayer (2004)</span> analyzed the choice of one of the 57 European regions belonging to 9 countries by Japenese firms to implement a new production unit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;JapaneseFDI&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;mlogit&quot;</span>)
jfdi &lt;-<span class="st"> </span><span class="kw">dfidx</span>(JapaneseFDI, <span class="dt">idx =</span> <span class="kw">list</span>(<span class="st">&quot;firm&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;country&quot;</span>)), <span class="dt">idnames =</span> <span class="kw">c</span>(<span class="st">&quot;chid&quot;</span>, <span class="st">&quot;alt&quot;</span>))</code></pre></div>
<p>Note that weâ€™ve used an extra argument to <code>dfidx</code> called <code>group.var</code> which indicates the grouping variable, which will be used later to define easily the nests. There are two sets of covariates: the wage rate <code>wage</code>, the unemployment rate <code>unemp</code>, a dummy indicating that the region is eligible to European funds <code>elig</code> and the area <code>area</code> are observed at the regional level and are therefore relevant for the estimation of the lower model, whereas the social cotisation rate <code>scrate</code> and the corporate tax rate <code>ctaxrate</code> are observed at the country level and are therefore suitable for the upper model.</p>
<p>We first estimate a multinomial logit model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ml.fdi &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(wage) <span class="op">+</span><span class="st"> </span>unemp <span class="op">+</span><span class="st"> </span>elig <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(area) <span class="op">+</span><span class="st"> </span>scrate <span class="op">+</span>
ctaxrate <span class="op">|</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">data =</span> jfdi)</code></pre></div>
<p>Note that, as the covariates are only alternative specific, the intercepts are not identified and therefore have been removed. We next estimate the lower model, which analyses the choice of a region within a given country. Therefore, for each choice situation, we estimate the choice of a region on the subset of regions of the country which has been chosen. Moreover, observations concerning Portugal and Ireland are removed as these two countries are mono-region.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">jfdi<span class="op">$</span>country &lt;-<span class="st"> </span>jfdi<span class="op">$</span>country
lm.fdi &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(wage) <span class="op">+</span><span class="st"> </span>unemp <span class="op">+</span><span class="st"> </span>elig <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(area) <span class="op">|</span><span class="st"> </span><span class="dv">0</span>,
<span class="dt">data =</span> jfdi, <span class="dt">subset =</span> country <span class="op">==</span><span class="st"> </span>choice.c <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="st"> </span>country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PT&quot;</span>, <span class="st">&quot;IE&quot;</span>))</code></pre></div>
<p>We next use the fitted lower model in order to compute the inclusive value, at the country level:</p>
<p><span class="math display">\[
\mbox{iv}_{ig} = \ln \sum_{j \in B_g} e^{\beta^\top x_{ij}},
\]</span></p>
<p>where <span class="math inline">\(B_g\)</span> is the set of regions for country <span class="math inline">\(g\)</span>. When a grouping variable is provided in the <code>dfidx</code> function, inclusive values are by default computed for every group <span class="math inline">\(g\)</span> (global inclusive values are obtained by setting the <code>type</code> argument to <code>&quot;global&quot;</code>). By default, <code>output</code> is set to <code>&quot;chid&quot;</code> and the results is a vector (if <code>type = &quot;global&quot;</code>) or a matrix (if <code>type = &quot;region&quot;</code>) with row number equal to the number of choice situations. If <code>output</code> is set to <code>&quot;obs&quot;</code>, a vector of length equal to the number of lines of the data in long format is returned. The following code indicates different ways to use the <code>logsum</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lmformula &lt;-<span class="st"> </span><span class="kw">formula</span>(lm.fdi)
<span class="kw">head</span>(<span class="kw">logsum</span>(ml.fdi, <span class="dt">data =</span> jfdi, <span class="dt">formula =</span> lmformula, <span class="dt">type =</span> <span class="st">&quot;group&quot;</span>), <span class="dv">2</span>)</code></pre></div>
<pre><code>##         BE       DE       ES       FR       IE       IT       NL
## 3 3.595818 5.415838 3.593702 5.153709 1.933707 5.051387 4.077845
## 4 4.113243 5.765190 4.445012 5.383095 1.960462 5.687569 4.490379
##         PT       UK
## 3 2.702028 4.900622
## 4 3.200124 5.378561</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">logsum</span>(ml.fdi, <span class="dt">data =</span> jfdi, <span class="dt">formula =</span> lmformula, <span class="dt">type =</span> <span class="st">&quot;global&quot;</span>))</code></pre></div>
<pre><code>##        3        4        5        7        8        9 
## 6.736116 7.182139 7.121855 7.084245 7.133368 7.133368</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">logsum</span>(ml.fdi, <span class="dt">data =</span> jfdi, <span class="dt">formula =</span> lmformula, <span class="dt">output =</span> <span class="st">&quot;obs&quot;</span>))</code></pre></div>
<pre><code>## [1] 3.595818 3.595818 3.595818 3.595818 5.415838 5.415838</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">logsum</span>(ml.fdi, <span class="dt">data =</span> jfdi, <span class="dt">formula =</span> lmformula, <span class="dt">type =</span> <span class="st">&quot;global&quot;</span>,
<span class="dt">output =</span> <span class="st">&quot;obs&quot;</span>))</code></pre></div>
<pre><code>## [1] 6.736116 6.736116 6.736116 6.736116 6.736116 6.736116</code></pre>
<p>To add the inclusive values in the original <code>data.frame</code>, we use <code>output = &quot;obs&quot;</code> and the <code>type</code> argument can be omitted as its default value is <code>&quot;group&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JapaneseFDI<span class="op">$</span>iv &lt;-<span class="st"> </span><span class="kw">logsum</span>(lm.fdi, <span class="dt">data =</span> jfdi, <span class="dt">formula =</span> lmformula,
<span class="dt">output =</span> <span class="st">&quot;obs&quot;</span>)</code></pre></div>
<p>We next select the relevant variables for the estimation of the upper model, select unique lines in order to keep only one observation for every choice situation / country combination and finally we coerce the response (<code>choice.c</code>) to a logical for the chosen country.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">JapaneseFDI.c &lt;-<span class="st"> </span><span class="kw">subset</span>(JapaneseFDI, 
<span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;firm&quot;</span>, <span class="st">&quot;country&quot;</span>, <span class="st">&quot;choice.c&quot;</span>, <span class="st">&quot;scrate&quot;</span>, <span class="st">&quot;ctaxrate&quot;</span>, <span class="st">&quot;iv&quot;</span>))
JapaneseFDI.c &lt;-<span class="st"> </span><span class="kw">unique</span>(JapaneseFDI.c)
JapaneseFDI.c<span class="op">$</span>choice.c &lt;-<span class="st"> </span><span class="kw">with</span>(JapaneseFDI.c, choice.c <span class="op">==</span><span class="st"> </span>country)</code></pre></div>
<p>Finally, we estimate the upper model, using the previously computed inclusive value as a covariate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">jfdi.c &lt;-<span class="st"> </span><span class="kw">dfidx</span>(JapaneseFDI.c, <span class="dt">choice =</span> <span class="st">&quot;choice.c&quot;</span>, <span class="dt">idnames =</span> <span class="kw">c</span>(<span class="st">&quot;chid&quot;</span>, <span class="st">&quot;alt&quot;</span>))
um.fdi &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice.c <span class="op">~</span><span class="st"> </span>scrate <span class="op">+</span><span class="st"> </span>ctaxrate <span class="op">+</span><span class="st"> </span>iv <span class="op">|</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">data =</span> jfdi.c)</code></pre></div>
<p>If one wants to obtain different <code>iv</code> coefficients for different countries, the <code>iv</code> covariate should be introduced in the 3th part of the formula and the coefficients for the two mono-region countries (Ireland and Portugal) should be set to 1, using the <code>constPar</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">um2.fdi &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice.c <span class="op">~</span><span class="st"> </span>scrate <span class="op">+</span><span class="st"> </span>ctaxrate <span class="op">|</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>iv, <span class="dt">data =</span> jfdi.c, 
                  <span class="dt">constPar =</span> <span class="kw">c</span>(<span class="st">&quot;iv:PT&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;iv:IE&quot;</span> =<span class="st"> </span><span class="dv">1</span>))</code></pre></div>
<p>We next estimate the full-information maximum likelihood nested model. It is obtained by adding a <code>nests</code> argument to the <code>mlogit</code> function. This should be a named list of alternatives (here regions), the names being the nests (here the countries). More simply, if a group variable has been indicated while using <code>dfidx</code>, <code>nests</code> can be a boolean.</p>
<p>Two flavors of nested models can be estimated, using the <code>un.nest.el</code> argument which is a boolean. If <code>TRUE</code>, one imposes that the coefficient associated with the inclusive utility is the same for every nest, which means that the degree of correlation inside each nest is the same. If <code>FALSE</code>, a different coefficient is estimated for every nest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nl.fdi &lt;-<span class="st"> </span><span class="kw">mlogit</span>(choice <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(wage) <span class="op">+</span><span class="st"> </span>unemp <span class="op">+</span><span class="st"> </span>elig <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(area) <span class="op">+</span><span class="st"> </span>scrate <span class="op">+</span>
ctaxrate <span class="op">|</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">data =</span> jfdi, <span class="dt">nests =</span> <span class="ot">TRUE</span>, <span class="dt">un.nest.el =</span> <span class="ot">TRUE</span>)
nl2.fdi &lt;-<span class="st"> </span><span class="kw">update</span>(nl.fdi, <span class="dt">un.nest.el =</span> <span class="ot">FALSE</span>, <span class="dt">constPar =</span> <span class="kw">c</span>(<span class="st">'iv:PT'</span> =<span class="st"> </span><span class="dv">1</span>,
<span class="st">'iv:IE'</span> =<span class="st"> </span><span class="dv">1</span>))</code></pre></div>
<p>The results of the fitted models are presented in the following table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;texreg&quot;</span>)
<span class="kw">htmlreg</span>(<span class="kw">list</span>(<span class="st">'Mult. logit'</span> =<span class="st"> </span>ml.fdi, <span class="st">'Lower model'</span> =<span class="st"> </span>lm.fdi,
             <span class="st">'Upper model'</span> =<span class="st"> </span>um.fdi, <span class="st">'Upper model'</span> =<span class="st"> </span>um2.fdi, <span class="st">'Nested logit'</span> =<span class="st"> </span>nl.fdi,
             <span class="st">'Nested logit'</span> =<span class="st"> </span>nl2.fdi),
        <span class="dt">fontsize =</span> <span class="st">&quot;footnotesize&quot;</span>, <span class="dt">float.pos =</span> <span class="st">&quot;hbt&quot;</span>,  <span class="dt">label =</span> <span class="st">&quot;tab:nlogit&quot;</span>,
        <span class="dt">caption =</span> <span class="st">&quot;Choice by Japanese firms of a european region.&quot;</span>)</code></pre></div>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<table cellspacing="0" align="center" style="border: none;">
<caption align="bottom" style="margin-top:0.3em;">
Choice by Japanese firms of a european region.
</caption>
<tr>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b></b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Mult. logit</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Lower model</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Upper model</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Upper model</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Nested logit</b>
</th>
<th style="text-align: left; border-top: 2px solid black; border-bottom: 1px solid black; padding-right: 12px;">
<b>Nested logit</b>
</th>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
log(wage)
</td>
<td style="padding-right: 12px; border: none;">
0.47
</td>
<td style="padding-right: 12px; border: none;">
1.21<sup style="vertical-align: 0px;">*</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.46
</td>
<td style="padding-right: 12px; border: none;">
0.77<sup style="vertical-align: 0px;">**</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.25)
</td>
<td style="padding-right: 12px; border: none;">
(0.48)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.25)
</td>
<td style="padding-right: 12px; border: none;">
(0.25)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
unemp
</td>
<td style="padding-right: 12px; border: none;">
-8.90<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-9.77<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
-7.62<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-6.95<sup style="vertical-align: 0px;">**</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(1.69)
</td>
<td style="padding-right: 12px; border: none;">
(2.39)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(1.60)
</td>
<td style="padding-right: 12px; border: none;">
(2.28)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
elig
</td>
<td style="padding-right: 12px; border: none;">
-0.25
</td>
<td style="padding-right: 12px; border: none;">
-0.89<sup style="vertical-align: 0px;">**</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
-0.34
</td>
<td style="padding-right: 12px; border: none;">
-0.18
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.21)
</td>
<td style="padding-right: 12px; border: none;">
(0.33)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.20)
</td>
<td style="padding-right: 12px; border: none;">
(0.18)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
log(area)
</td>
<td style="padding-right: 12px; border: none;">
0.31<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
0.29<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.29<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
0.15<sup style="vertical-align: 0px;">**</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.05)
</td>
<td style="padding-right: 12px; border: none;">
(0.06)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.05)
</td>
<td style="padding-right: 12px; border: none;">
(0.05)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
scrate
</td>
<td style="padding-right: 12px; border: none;">
-2.26<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
-2.49<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
0.15
</td>
<td style="padding-right: 12px; border: none;">
-2.44<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-0.88
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.38)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.38)
</td>
<td style="padding-right: 12px; border: none;">
(1.72)
</td>
<td style="padding-right: 12px; border: none;">
(0.38)
</td>
<td style="padding-right: 12px; border: none;">
(0.86)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
ctaxrate
</td>
<td style="padding-right: 12px; border: none;">
-4.82<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
-3.69<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-1.78
</td>
<td style="padding-right: 12px; border: none;">
-4.13<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
-2.35
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.59)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.60)
</td>
<td style="padding-right: 12px; border: none;">
(1.32)
</td>
<td style="padding-right: 12px; border: none;">
(0.66)
</td>
<td style="padding-right: 12px; border: none;">
(1.25)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.66<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.85<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.06)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.08)
</td>
<td style="padding-right: 12px; border: none;">
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:BE
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.72<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.48<sup style="vertical-align: 0px;">*</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.08)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.19)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:DE
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.72<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.52<sup style="vertical-align: 0px;">**</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.08)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.17)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:ES
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.86<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.77<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.05)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.20)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:FR
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.75<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.67<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.04)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.09)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:IT
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.62<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.25<sup style="vertical-align: 0px;">**</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.05)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.08)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:NL
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.69<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.18
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.06)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.10)
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
iv:UK
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.87<sup style="vertical-align: 0px;">***</sup>
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
0.86<sup style="vertical-align: 0px;">***</sup>
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.06)
</td>
<td style="padding-right: 12px; border: none;">
</td>
<td style="padding-right: 12px; border: none;">
(0.10)
</td>
</tr>
<tr>
<td style="border-top: 1px solid black;">
AIC
</td>
<td style="border-top: 1px solid black;">
3469.13
</td>
<td style="border-top: 1px solid black;">
1738.04
</td>
<td style="border-top: 1px solid black;">
1746.58
</td>
<td style="border-top: 1px solid black;">
1713.86
</td>
<td style="border-top: 1px solid black;">
3467.96
</td>
<td style="border-top: 1px solid black;">
3437.01
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;">
Log Likelihood
</td>
<td style="padding-right: 12px; border: none;">
-1728.57
</td>
<td style="padding-right: 12px; border: none;">
-865.02
</td>
<td style="padding-right: 12px; border: none;">
-870.29
</td>
<td style="padding-right: 12px; border: none;">
-845.93
</td>
<td style="padding-right: 12px; border: none;">
-1726.98
</td>
<td style="padding-right: 12px; border: none;">
-1703.50
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid black;">
Num. obs.
</td>
<td style="border-bottom: 2px solid black;">
452
</td>
<td style="border-bottom: 2px solid black;">
421
</td>
<td style="border-bottom: 2px solid black;">
452
</td>
<td style="border-bottom: 2px solid black;">
452
</td>
<td style="border-bottom: 2px solid black;">
452
</td>
<td style="border-bottom: 2px solid black;">
452
</td>
</tr>
<tr>
<td style="padding-right: 12px; border: none;" colspan="8">
<span style="font-size:0.8em"><sup style="vertical-align: 0px;"><em><strong></sup>p &lt; 0.001, <sup style="vertical-align: 0px;"></strong></sup>p &lt; 0.01, <sup style="vertical-align: 0px;"></em></sup>p &lt; 0.05</span>
</td>
</tr>
</table>
<p>For the nested logit models, two tests are of particular interest:</p>
<ul>
<li>the test of no nests, which means that all the nest elasticities are equal to 1,</li>
<li>the test of unique nest elasticities, which means that all the nest elasticities are equal to each other.</li>
</ul>
<p>For the test of no nests, the nested model is provided as the unique argument for the <code>lrtest</code> and the <code>waldtest</code> function. For the <code>scoretest</code>, the constrained model (i.e., the multinomial logit model) is provided as the first argument and the second argument is <code>nests</code>, which describes the nesting structure that one wants to test.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lr.nest &lt;-<span class="st"> </span><span class="kw">lrtest</span>(nl2.fdi)
wd.nest &lt;-<span class="st"> </span><span class="kw">waldtest</span>(nl2.fdi)
sc.nest &lt;-<span class="st"> </span><span class="kw">scoretest</span>(ml.fdi, <span class="dt">nests =</span> <span class="ot">TRUE</span>, <span class="dt">constPar =</span> <span class="kw">c</span>(<span class="st">'iv:PT'</span> =<span class="st"> </span><span class="dv">1</span>,
<span class="st">'iv:IE'</span> =<span class="st"> </span><span class="dv">1</span>))</code></pre></div>
<p>The Wald test can also be performed using the <code>linearHypothesis</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lh.nest &lt;-<span class="st"> </span><span class="kw">linearHypothesis</span>(nl2.fdi, <span class="kw">c</span>(<span class="st">&quot;iv:BE = 1&quot;</span>, <span class="st">&quot;iv:DE = 1&quot;</span>,
<span class="st">&quot;iv:ES = 1&quot;</span>, <span class="st">&quot;iv:FR = 1&quot;</span>, <span class="st">&quot;iv:IT = 1&quot;</span>, <span class="st">&quot;iv:NL = 1&quot;</span>, <span class="st">&quot;iv:UK = 1&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(<span class="kw">list</span>(<span class="dt">wald =</span> wd.nest, <span class="dt">lh =</span> lh.nest, <span class="dt">score =</span> sc.nest, <span class="dt">lr =</span> lr.nest),
statpval)</code></pre></div>
<pre><code>##            wald      lh score     lr
## stat    208.407 208.407 60.28 50.122
## p-value   0.000   0.000  0.00  0.000</code></pre>
<p>The three tests reject the null hypothesis of no correlation. We next test the hypothesis that all the nest elasticities are equal.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lr.unest &lt;-<span class="st"> </span><span class="kw">lrtest</span>(nl2.fdi, nl.fdi)
wd.unest &lt;-<span class="st"> </span><span class="kw">waldtest</span>(nl2.fdi, <span class="dt">un.nest.el =</span> <span class="ot">TRUE</span>)
sc.unest &lt;-<span class="st"> </span><span class="kw">scoretest</span>(ml.fdi, <span class="dt">nests =</span> <span class="ot">TRUE</span>, <span class="dt">un.nest.el =</span> <span class="ot">FALSE</span>,
<span class="dt">constPar =</span> <span class="kw">c</span>(<span class="st">'iv:PT'</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">'iv:IE'</span> =<span class="st"> </span><span class="dv">1</span>))
lh.unest &lt;-<span class="st"> </span><span class="kw">linearHypothesis</span>(nl2.fdi, <span class="kw">c</span>(<span class="st">&quot;iv:BE = iv:DE&quot;</span>, <span class="st">&quot;iv:BE = iv:ES&quot;</span>, 
<span class="st">&quot;iv:BE = iv:FR&quot;</span>, <span class="st">&quot;iv:BE = iv:IT&quot;</span>, <span class="st">&quot;iv:BE = iv:NL&quot;</span>, <span class="st">&quot;iv:BE = iv:UK&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(<span class="kw">list</span>(<span class="dt">wald =</span> wd.unest, <span class="dt">lh =</span> lh.unest, <span class="dt">score =</span> sc.unest,
<span class="dt">lr =</span> lr.unest), statpval)</code></pre></div>
<pre><code>##           wald     lh score     lr
## stat    73.535 73.535 60.28 46.954
## p-value  0.000  0.000  0.00  0.000</code></pre>
<p>Once again, the three tests strongly reject the hypothesis.</p>
</div>
</div>
<div id="bibliography" class="section level2 unnumbered">
<h2>Bibliography</h2>
<div id="refs" class="references">
<div id="ref-BHAT:95">
<p>Bhat, Chandra R. 1995. â€œA Heteroscedastic Extreme Value Model of Intercity Travel Mode Choice.â€ <em>Transportation Research Part B: Methodological</em> 29 (6): 471â€“83. <a href="http://www.sciencedirect.com/science/article/pii/0191261595000156" class="uri">http://www.sciencedirect.com/science/article/pii/0191261595000156</a>.</p>
</div>
<div id="ref-DALY:87">
<p>Daly, A. 1987. â€œEstimating â€˜Treeâ€™ Logit Models.â€ <em>Transportation Research B</em>, 251â€“67.</p>
</div>
<div id="ref-HEAD:MAYE:04">
<p>Head, Keith, and Thierry Mayer. 2004. â€œMarket Potential and the Location of Japanese Investment in the European Union.â€ <em>The Review of Economics and Statistics</em> 86 (4): 959â€“72. doi:<a href="https://doi.org/10.1162/0034653043125257">10.1162/0034653043125257</a>.</p>
</div>
<div id="ref-HEIS:02">
<p>Heiss, Florian. 2002. â€œStructural Choice Analysis with Nested Logit Models.â€ <em>The Stata Journal</em> 2 (3): 227â€“52.</p>
</div>
<div id="ref-HENS:GREEN:02">
<p>Hensher, David A., and William H. Greene. 2002. â€œSpecification and Estimation of the Nested Logit Model: Alternative Normalisations.â€ <em>Transportation Research Part B</em> 36: 1â€“17.</p>
</div>
<div id="ref-KOPP:WEN:98">
<p>Koppelman, Franck S., and Chieh-Hua Wen. 1998. â€œAlternative Nested Logit Models: Structure, Properties and Estimation.â€ <em>Transportation Research B</em> 32 (5): 289â€“98.</p>
</div>
<div id="ref-MCFAD:78">
<p>McFadden, D. 1978. â€œSpatial Interaction Theory and Planning Models.â€ In <em>Modeling the Choice of Residential Location</em>, edited by A. Karlqvist, 75â€“96. North-Holland, Amsterdam.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A slightly different version of the nested logit model <span class="citation">(Daly 1987)</span> is often used, but is not compatible with the random utility maximization hypothesis. Its difference with the previous expression is that the deterministic parts of the utility for each alternative is not divided by the nest elasticity. The differences between the two versions have been discussed in <span class="citation">Koppelman and Wen (1998)</span>, <span class="citation">Heiss (2002)</span> and <span class="citation">Hensher and Greene (2002)</span>.<a href="#fnref1">â†©</a></p></li>
<li id="fn2"><p>Weâ€™ve already encountered this expression in vignette 3. Random utility model and the multinomial logit model.<a href="#fnref2">â†©</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
